import com.proteusframework.build.Property

import static groovy.io.FileVisitResult.CONTINUE
import static groovy.io.FileVisitResult.SKIP_SUBTREE


// Check required properties
def props = [
    new Property(name:'repo_venturetech_username',description:'Username to access the artifact repository'),
    new Property(name:'repo_venturetech_password',description:'Password to access the artifact repository'),
    new Property(name:'publish_venturetech_username',description:'Username to upload to the artifact repository', required:false),
    new Property(name:'publish_venturetech_password',description:'Password to upload to the artifact repository', required:false),
];

println '\n\n!!!!! HEY YOU - SET THE PROJECT NAME !!!!\n'
settings.rootProject.name = 'example-app'


settings.gradle.projectsLoaded( {
    props.each({it.test(settings)})
    settings.gradle.rootProject.ext.hasLocalRepo = settings.hasProperty('local_repo');
})

// Did you convert this to be your own project.
if(new File(settings.rootProject.projectDir,'src/main/java/com/example/app/config/ExampleAppProjectConfig.java').exists())
    throw new Error('Rename your project configuration class')

def files = []
settings.rootProject.projectDir.traverse(
    [nameFilter: ~/.*\.java/,
        preDir: { if (it.name == '.git' || it.name == '.apt_generated') return SKIP_SUBTREE }], { f ->

    if( f.filterLine( { it ==~ /.*com.example.app.*/ } ) as String )
        files.add(f)

    CONTINUE
})
if(files.isEmpty())
    throw new Error('Remove this example-app code check.')
else
    throw new Error("Update your code. This is no longer example-app: \n\t${files.join('\n\t')}")


